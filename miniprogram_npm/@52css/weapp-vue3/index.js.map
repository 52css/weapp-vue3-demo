{"version":3,"sources":["weapp-vue3.js"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA","file":"index.js","sourcesContent":["!function(e,t){\"object\"==typeof exports&&\"undefined\"!=typeof module?t(exports):\"function\"==typeof define&&define.amd?define([\"exports\"],t):t(((e=\"undefined\"!=typeof globalThis?globalThis:e||self)[\"weapp-vue3\"]=e[\"weapp-vue3\"]||{},e[\"weapp-vue3\"].js={}))}(this,function(e){function s(e){return new Set(e)}const o=e=>{var t={},n={};for(const i in e)\"function\"==typeof e[i]?n[i]=e[i]:t[i]=e[i];return{fields:t,methods:n}},u=(r,e)=>{D($(e()),(e,t)=>{{const{fields:n,methods:i}=o(e);Object.keys(i).forEach(e=>{r[e]=i[e]}),r.setData(n)}},{immediate:!0})},a=e=>null!==e&&\"object\"==typeof e,n=Object.assign;let t=void 0,i=!1;const c=new WeakMap;class r{constructor(e,t){this.fn=e,this.scheduler=t,this.active=!0,this.deps=[],console.log(\"创建 ReactiveEffect 对象\")}run(){if(console.log(\"run\"),!this.active)return this.fn();i=!0,t=this,console.log(\"执行用户传入的 fn\");var e=this.fn();return i=!1,t=void 0,e}stop(){var t;this.active&&((t=this).deps.forEach(e=>{e.delete(t)}),t.deps.length=0,this.onStop&&this.onStop(),this.active=!1)}}function f(e,t={}){e=new r(e),n(e,t),e.run(),t=e.run.bind(e);return t.effect=e,t}function l(e){e.has(t)||(e.add(t),t.deps.push(e))}function d(){return i&&void 0!==t}function h(e){for(const t of e)t.scheduler?t.scheduler():t.run()}var p=y(),v=y(!0),_=y(!0,!0);function y(t=!1,o=!1){return function(n,i,e){if(\"__v_isReactive\"===i)return!t;if(\"__v_isReadonly\"===i)return t;if(\"__v_raw\"===i&&e===m.get(n)||\"__v_raw\"===i&&e===b.get(n)||\"__v_raw\"===i&&e===k.get(n))return n;e=Reflect.get(n,i,e);if(!t){var r=\"get\";if(d()){console.log(`触发 track -> target: ${n} type:${r} key:`+i);let e=c.get(n),t=(e||(e=new Map,c.set(n,e)),e.get(i));t||(t=s(),e.set(i,t)),l(t)}}return!o&&a(e)?(t?x:j)(e):e}}const g={get:v,set(e,t){return console.warn(`Set operation on key \"${String(t)}\" failed: target is readonly.`,e),!0}},w={get:p,set:function(e,t,n,i){n=Reflect.set(e,t,n,i),i=e,e=t,t=[];if(i=c.get(i)){i=i.get(e);t.push(i);const r=[];t.forEach(e=>{r.push(...e)}),h(s(r))}return n}},R={get:_,set(e,t){return console.warn(`Set operation on key \"${String(t)}\" failed: target is readonly.`,e),!0}},m=new WeakMap,b=new WeakMap,k=new WeakMap;function j(e){return M(e,m,w)}function x(e){return M(e,b,g)}function S(e){return!!e.__v_isReadonly}function P(e){return!!e.__v_isReactive}function M(e,t,n){var i=t.get(e);return i||(i=new Proxy(e,n),t.set(e,i),i)}class T{constructor(e){this.__v_isRef=!0,this._rawValue=e,this._value=E(e),this.dep=s()}get value(){return W(this),this._value}set value(e){var t;t=this._rawValue,Object.is(e,t)||(this._value=E(e),this._rawValue=e,O(this))}}function E(e){return a(e)?j(e):e}function O(e){h(e.dep)}function W(e){d()&&l(e.dep)}const z={get(e,t,n){return V(Reflect.get(e,t,n))},set(e,t,n,i){return C(e[t])&&!C(n)?e[t].value=n:Reflect.set(e,t,n,i)}};function $(e){return new Proxy(e,z)}function V(e){return C(e)?e.value:e}function C(e){return!!e.__v_isRef}class L{constructor(e){this._dirty=!0,this.dep=s(),this.effect=new r(e,()=>{this._dirty||(this._dirty=!0,O(this))})}get value(){return W(this),this._dirty&&(this._dirty=!1,this._value=this.effect.run()),this._value}}function D(e,t,n={}){let i;i=\"function\"==typeof e?e:()=>function e(t,n=new Set){if(\"object\"==typeof t&&null!==t&&!n.has(t)){n.add(t);for(const i in t)e(t[i],n);return t}}(e);let r,o,s;function u(e){s=e}const a=()=>{o=c(),s&&s(),t(o,r,u),r=o},c=f(()=>i(),{lazy:!0,scheduler:()=>{\"post\"===n.flush?Promise.resolve().then(a):a()}});n.immediate?a():r=c()}e.Component=function(e){let t={},n;var i;n=\"function\"!=typeof e?(t=e.props,e.setup):e,Component({behaviors:[],properties:(i=t,Object.keys(i).reduce((e,t)=>(e[t]=i[t].default?{type:i[t].type,value:i[t].default}:i[t],e),{})),data:{},lifetimes:{created(){},attached(){r=this,e=t;var r,e=new Proxy(e,{get(e,t,n){let i=r.data[t];return i=void 0===i?e[t].default:i},set:function(e,t,n,i){return r.setData({[t]:n}),Reflect.set(e,t,n,i)}});u(this,n.bind(null,e))},moved(){},detached(){}},methods:{}})},e.Page=function(e){Page({onLoad(){u(this,e)}})},e.computed=function(e){return new L(e)},e.effect=f,e.isProxy=function(e){return P(e)||S(e)},e.isReactive=P,e.isReadonly=S,e.isRef=C,e.proxyRefs=$,e.reactive=j,e.readonly=x,e.ref=function(e){return e=new T(e)},e.shallowReadonly=function(e){return M(e,k,R)},e.stop=function(e){e.effect.stop()},e.unRef=V,e.watch=D});\n//# sourceMappingURL=weapp-vue3.js.map\n"]}